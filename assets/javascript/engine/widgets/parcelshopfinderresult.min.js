"use strict";gambio.widgets.module("parcelshopfinderresult",[],function(e){var n=($(this),{}),t=($.extend(!0,{},n,e),{}),a=function(){var e,n,t,a=[];e=new google.maps.Map(document.getElementById("map"),{center:markerData[0].position,zoom:14}),e.addListener("click",function(a){console.log(a),n.geocode({location:a.latLng},function(n,a){if("OK"===a){if(console.log(n),"street_address"===n[0].types[0]){var o=n[0].formatted_address;t?(t.setPosition(n[0].geometry.location),t.setTitle(o)):t=new google.maps.Marker({map:e,position:n[0].geometry.location,title:o});var s=void 0,i=void 0,r=void 0,l=void 0,p=void 0,m=void 0;n[0].address_components.forEach(function(e){e.types.indexOf("street_number")>=0&&(i=e.long_name,$('input[name="house"]').val(i)),e.types.indexOf("route")>=0&&(s=e.long_name,$('input[name="street"]').val(s)),e.types.indexOf("postal_code")>=0&&(r=e.long_name,$('input[name="zip"]').val(r)),e.types.indexOf("locality")>=0&&(l=e.long_name,$('input[name="city"]').val(l)),e.types.indexOf("country")>=0&&(p=e.long_name,m=e.short_name,$('select[name="country"] option[value="'+m+'"]').length>0&&$('select[name="country"]').val(m))}),$("#psf-form").trigger("submit")}}else console.log("geocoder failed - "+a)})}),markerData.forEach(function(n){n.map=e;var t=new google.maps.Marker(n);t.addListener("click",function(e){var o=n.label,s=$("tr#marker_"+o),i=s.offset();$("html, body").animate({scrollTop:i.top-$("body").height()/2},500),s.addClass("marker_clicked"),$("tr.parcelshop").not(s).removeClass("marker_clicked"),a.forEach(function(e,n){e.setAnimation(null)}),t.setAnimation(google.maps.Animation.BOUNCE)}),a.push(t),$("#marker_"+n.label+" div.mapmarkerlabel_icon").on("click",function(n){var o=$(this).closest("tr");e.setCenter(t.getPosition()),a.forEach(function(e,n){e.setAnimation(null)}),t.setAnimation(google.maps.Animation.BOUNCE),o.addClass("marker_clicked"),$("tr.parcelshop").not(o).removeClass("marker_clicked"),$("#map").get(0).scrollIntoView({behavior:"smooth",block:"end"})})}),n=new google.maps.Geocoder,n.geocode({address:searchAddress},function(n,t){if("OK"==t){e.setCenter(n[0].geometry.location);new google.maps.Marker({map:e,position:n[0].geometry.location})}})};return t.init=function(e){var n=function(e){1==e?$("#psf_make_new_ab_entry").removeAttr("disabled"):$("#psf_make_new_ab_entry").attr("disabled","disabled")},t=function(){n($("#psf_new_ab input").hasClass("invalid")===!1)};$("button.prepare_ab_entry").on("click",function(e){e.preventDefault();var n,a=$(this).closest("tr"),o=$("strong.parcelshop_heading",a).text(),s=$("span.street_address",a).text(),i=$("span.house_number",a).text(),r=$("span.additional_info",a).text(),l=$("span.country_iso",a).text(),p=$("span.postcode",a).text(),m=$("span.city",a).text(),c=$("span.shop_name",a).text();"DE"!==l&&(r=r+" ("+c+")"),n=o,c.length>0&&(n+=", "+c),n+=", "+p+" "+m,$("#psf_name").val(n),$('#psf_new_ab input[name="street_address"]').val(s),$('#psf_new_ab input[name="house_number"]').val(i),$('#psf_new_ab input[name="additional_info"]').val(r),$('#psf_new_ab input[name="country"]').val(l),$('#psf_new_ab input[name="postcode"]').val(p),$('#psf_new_ab input[name="city"]').val(m),$("#psf_name").removeClass("invalid"),$("#psf_new_ab").show("fast",function(){$("#psf_new_ab").get(0).scrollIntoView({behavior:"smooth",block:"end"})}),t()}),$('#psf_new_ab input[name="firstname"], #psf_new_ab input[name="lastname"]').on("keyup",function(e){$(e.target).toggleClass("invalid",$(e.target).val().length<=2),t()}),$('#psf_new_ab input[name="postnumber"]').on("keyup",function(e){$(this).val().length>5?$.ajax({url:jse.core.config.get("appUrl")+"/shop.php?do=Parcelshopfinder/ValidatePostnumber&postnumber="+$(this).val(),dataType:"json"}).done(function(e){$('#psf_new_ab input[name="postnumber"]').toggleClass("invalid",e.postnumberIsValid!==!0),t()}):($('#psf_new_ab input[name="postnumber"]').toggleClass("invalid",!0),t())}),$('#psf_new_ab input[name="postnumber"]').on("change",function(e){$('#psf_new_ab input[name="postnumber"]').trigger("keyup")}),$("#psf_new_ab input").trigger("keyup"),"undefined"!=typeof psfDynamic&&psfDynamic===!0&&a(),e()},t});