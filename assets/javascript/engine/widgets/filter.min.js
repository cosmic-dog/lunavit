"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};gambio.widgets.module("filter",["form","xhr"],function(e){var t=$(this),i=$("body"),o=null,n=null,r=null,a=null,l=null,s=null,p=!1,c=!1,d=!1,u={requestUrl:"shop.php?do=Filter",resetProductlistingFilter:!1,autoUpdate:!0,updateDelay:200,retries:2,retryDelay:500,selectorMapping:{filterForm:".filter-box-form-wrapper",productsContainer:".product-filter-target",filterSelectionContainer:".filter-selection-container",listingPagination:".productlisting-filter-container .panel-pagination",filterHiddenContainer:".productlisting-filter-container .productlisting-filter-hiddens",paginationInfo:".pagination-info"}},f=$.extend(!0,{},u,e),g={},h=function(e){var i="";s&&s.abort(),c&&(i="&reset=true"),s=$.ajax({url:f.requestUrl+"/GetListing&"+t.serialize()+i,method:"GET",dataType:"json"}).done(function(i){if("undefined"!=typeof i.redirect)return void(location.href=i.redirect);!d&&f.autoUpdate&&($(window).on("popstate",U),d=!0),jse.libs.template.helpers.fill(i.content,n,f.selectorMapping);var o=$(f.selectorMapping.productsContainer);o.attr("data-gambio-widget","cart_handler"),gambio.widgets.init(o);var r=$(f.selectorMapping.productsContainer).parent("div");if(r.attr("data-gambio-widget","product_hover"),r.attr("data-product_hover-scope",".productlist-viewmode-grid"),gambio.widgets.init(r),p&&e){var a=decodeURIComponent(t.serialize());history.pushState({},"filter",location.origin+location.pathname+"?"+a+location.hash),t.trigger("pushstate",[])}else t.trigger("pushstate_no_history",[])})},m=function(e,t){var i=[];return $.each(e.filter_fv_id,function(e,o){if(void 0!==o&&o!==!1)if("object"===("undefined"==typeof o?"undefined":_typeof(o))){var n=[];$.each(o,function(e,t){t!==!1&&n.push(t)}),t?i.push(e+":"+n.join("|")):(i[e]=i[e]||[],i[e]=n)}else i.push(e+":"+o)}),e.filter_fv_id=t?i.join("&"):i,delete e.value_conjunction,e},b=function C(e,n,a){o.removeClass("error").show(),l&&l.abort(),l=jse.libs.xhr.ajax({url:f.requestUrl,data:n},!0).done(function(e){var n=$(e.content.filter.selector).find("input:checkbox").length,r=$(e.content.filter.selector);if(n){var l=$("<div/>").appendTo("body").hide();t.children().appendTo(l).clone().appendTo(t),jse.libs.template.helpers.fill(e.content,l,f.selectorMapping),gambio.widgets.init(l);var s=setInterval(function(){l.find(".single-checkbox").length>0&&(t.children().remove(),l.children().appendTo(t),l.remove(),o.hide(),f.autoUpdate&&h(a),clearInterval(s))},300)}else jse.libs.template.helpers.fill(e.content,i,f.selectorMapping),gambio.widgets.init(r),o.hide(),f.autoUpdate&&h(a);location.href.search(/advanced_search_result\.php/g)!==-1&&$("h1").css("visibility","hidden"),window.gambio.widgets.init(t)}).fail(function(){e<f.retries?r=setTimeout(function(){C(e+1,n,a)},f.retryDelay):o.addClass("error")})},v=function(e){var i=jse.libs.form.getData(t);e=void 0===e||!!e,b(0,m(i,!0),e)},y=function(e){c=!1,f.autoUpdate?(e.preventDefault(),e.stopPropagation(),$.magnificPopup.close()):f.resetProductlistingFilter||jse.libs.form.addHiddenByUrl(t)},j=function(e){e.preventDefault(),e.stopPropagation(),clearTimeout(a),clearTimeout(r),a=setTimeout(v,f.updateDelay)},w=function(e){e.preventDefault(),e.stopPropagation(),jse.libs.form.reset(t),jse.libs.form.addHiddenByUrl(t),c=!0,f.autoUpdate?v():location.href=location.pathname+"?"+t.serialize()},U=function(){jse.libs.form.reset(t),jse.libs.form.prefillForm(t,jse.libs.template.helpers.getUrlParams()),v(!1)},_=function(){$(this).parent().removeClass("collapsed"),$(this).hide()},x=function(e){var t=$(this).attr("rel");e.preventDefault(),e.stopPropagation(),$("#"+t).prop("checked",!0).trigger("change")};return g.init=function(e){o=t.find(".preloader, .preloader-message"),n=$(".main-inside"),p=jse.core.config.get("history"),0===$(f.selectorMapping.productsContainer).length&&(f.autoUpdate=!1),t.on("change",'select, input[type="checkbox"], input[type="text"]',j).on("click",".btn-link",x).on("reset",w).on("submit",y).on("click",".show-more",_),i.addClass("filterbox-enabled"),e()},g});