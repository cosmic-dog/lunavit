"use strict";gambio.widgets.module("product_hover",[gambio.source+"/libs/events"],function(e){var t=$(this),o=$(window),n=$("body"),r=null,a=null,i=null,s=0,c={delay:50,flyoverClass:"flyover",scope:"",container:"#wrapper",productUrlSelector:".product-url"},l=$.extend(!0,{},c,e),u={},d=function(e){var t=n.children("."+l.flyoverClass);t=e?t:t.filter(".product-hover-"+i),t.remove()},f=function(e){e.find(".thumbnails img").each(function(){var e=$(this),t=$("<img />"),o=e.data(),n=o.thumbSrc||o.src,r=null;t.on("load",function(){r=e.closest("li"),r.addClass("loaded").css({background:'#FFFFFF url("'+n+'") no-repeat center',"background-size":"contain"}).find("img, .align-helper").remove()}).attr("src",n)})},h=function(e){e.preventDefault();var t=$(this),o=t.closest("."+l.flyoverClass),n=t.css("background-image");n=n.replace("/thumbnail_images/","/info_images/").replace("/gallery_images/","/thumbnail_images/").replace(/["']/gm,"");var r=n.match(/url\((.+)\)/);r&&r[1]&&(n=r[1]),n&&o.find(".product-hover-main-image > img").attr("src",n)},p=function(e){e.stopPropagation(),a=a?clearTimeout(a):null,a=window.setTimeout(d,l.delay)},m=function w(e){e.stopPropagation();var o=$(this),s=null,c=n,u=o.data().uid||parseInt(1e4*Math.random(),10),m=c.children("."+l.flyoverClass+".product-hover-"+i+'[data-product_hover-uid="'+u+'"]'),v=o.offset();a=a?clearTimeout(a):null,o.hasClass(l.flyoverClass)||m.length||(d(!0),t.trigger(jse.libs.template.events.OPEN_FLYOUT(),t),o.attr("data-product_hover-uid",u).data("uid",u),s=o.clone(!0),f(s),s.addClass(l.flyoverClass+" product-hover-"+i).css({position:"absolute",left:v.left,top:v.top,width:o[0].getBoundingClientRect().width,height:o[0].getBoundingClientRect().height}),s.on("mouseenter",w).on("mouseleave",p).on("mouseenter",".thumbnails",h).on("click",b),n.append(s),r.offset().left>s.offset().left&&s.addClass("gallery-right"))},v=function(){var e=n.children("."+l.flyoverClass+".product-hover-"+i);e.each(function(){var e=$(this),o=e.data().uid,n=t.find('[data-product_hover-uid="'+o+'"]'),r=n.offset();e.css({left:r.left,top:r.top,width:2*n.outerWidth()})})},g=function(e,o){t!==o&&d()},b=function(e){function t(){if(n.length){var t=n.attr("href");if(void 0!==t){if(e.stopPropagation(),e.preventDefault(),(new Date).getTime()-s<100)return;switch(s=(new Date).getTime(),e.which){case 1:if(e.ctrlKey)return void window.open(t,"_blank");break;case 2:return void window.open(t,"_blank");case 3:return}location.href=t}}}var o=$(this);$(this).hasClass("product-container")===!1&&(o=$(this).closest(".product-container"));var n=o.find(l.productUrlSelector).first();jse.libs.hooks.execute(jse.libs.hooks.keys.shop.product.listing.hover,{container:o},500).then(t)["catch"](t)};return u.init=function(e){i=parseInt(1e4*Math.random(),10),r=$(l.container),t.on("touchstart",function(){t.off("mouseenter mouseleave")}).on("touchend",function(){t.off("mouseenter",l.scope+" .product-container",m).off("mouseleave",l.scope+" .product-container",p)}).on("mouseenter",l.scope+" .product-container",m).on("mouseleave",l.scope+" .product-container",p),t.find(".product-container .product-image").on("click mouseup",b),n.on(jse.libs.template.events.OPEN_FLYOUT(),g),o.on("resize",v),e()},u});