'use strict';

/* --------------------------------------------------------------
 gift.js 2018-04-24
 Gambio GmbH
 http://www.gambio.de
 Copyright (c) 2016 Gambio GmbH
 Released under the GNU General Public License (Version 2)
 [http://www.gnu.org/licenses/gpl-2.0.html]
 --------------------------------------------------------------
 */

gambio.widgets.module('gift', ['xhr', 'form'], function (data) {

	'use strict';

	// ########## VARIABLE INITIALIZATION ##########

	var $this = $(this),
	    url = null,
	    defaults = {},
	    selectorMapping = {
		giftContent: '.gift-cart-content-wrapper'
	},
	    options = $.extend(true, {}, defaults, data),
	    module = {};

	var _submitHandler = function _submitHandler(e) {
		e.preventDefault();
		e.stopPropagation();

		var dataset = jse.libs.form.getData($this);

		jse.libs.xhr.ajax({ url: url, data: dataset }, true).done(function (result) {
			jse.libs.template.helpers.fill(result.content, $this, selectorMapping);

			var $detailsLink = $this.find('.gift-cart-show-details');
			if ($detailsLink.size()) {
				$detailsLink.on('click', _showDetails);
			}
		});
	};

	var _showDetails = function _showDetails(e) {
		e.preventDefault();
		e.stopPropagation();

		var detailsUrl = $(this).data('url');

		$.ajax({
			url: detailsUrl
		}).success(function (result) {
			$('div.redeem-code-details-wrapper').html(result).show();
			$('div.redeem-code-wrapper').hide();
		});
	};

	// ########## INITIALIZATION ##########

	/**
  * Init function of the widget
  * @constructor
  */
	module.init = function (done) {

		url = $this.attr('action');

		$this.on('submit', _submitHandler);

		done();
	};

	// Return data to widget engine
	return module;
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndpZGdldHMvZ2lmdC5qcyJdLCJuYW1lcyI6WyJnYW1iaW8iLCJ3aWRnZXRzIiwibW9kdWxlIiwiZGF0YSIsIiR0aGlzIiwiJCIsInVybCIsImRlZmF1bHRzIiwic2VsZWN0b3JNYXBwaW5nIiwiZ2lmdENvbnRlbnQiLCJvcHRpb25zIiwiZXh0ZW5kIiwiX3N1Ym1pdEhhbmRsZXIiLCJlIiwicHJldmVudERlZmF1bHQiLCJzdG9wUHJvcGFnYXRpb24iLCJkYXRhc2V0IiwianNlIiwibGlicyIsImZvcm0iLCJnZXREYXRhIiwieGhyIiwiYWpheCIsImRvbmUiLCJyZXN1bHQiLCJ0ZW1wbGF0ZSIsImhlbHBlcnMiLCJmaWxsIiwiY29udGVudCIsIiRkZXRhaWxzTGluayIsImZpbmQiLCJzaXplIiwib24iLCJfc2hvd0RldGFpbHMiLCJkZXRhaWxzVXJsIiwic3VjY2VzcyIsImh0bWwiLCJzaG93IiwiaGlkZSIsImluaXQiLCJhdHRyIl0sIm1hcHBpbmdzIjoiOztBQUFBOzs7Ozs7Ozs7O0FBVUFBLE9BQU9DLE9BQVAsQ0FBZUMsTUFBZixDQUNDLE1BREQsRUFHQyxDQUFDLEtBQUQsRUFBUSxNQUFSLENBSEQsRUFLQyxVQUFTQyxJQUFULEVBQWU7O0FBRWQ7O0FBRUY7O0FBRUUsS0FBSUMsUUFBUUMsRUFBRSxJQUFGLENBQVo7QUFBQSxLQUNDQyxNQUFNLElBRFA7QUFBQSxLQUVDQyxXQUFXLEVBRlo7QUFBQSxLQUdDQyxrQkFBa0I7QUFDakJDLGVBQWE7QUFESSxFQUhuQjtBQUFBLEtBTUNDLFVBQVVMLEVBQUVNLE1BQUYsQ0FBUyxJQUFULEVBQWUsRUFBZixFQUFtQkosUUFBbkIsRUFBNkJKLElBQTdCLENBTlg7QUFBQSxLQU9DRCxTQUFTLEVBUFY7O0FBVUEsS0FBSVUsaUJBQWlCLFNBQWpCQSxjQUFpQixDQUFTQyxDQUFULEVBQVk7QUFDaENBLElBQUVDLGNBQUY7QUFDQUQsSUFBRUUsZUFBRjs7QUFFQSxNQUFJQyxVQUFVQyxJQUFJQyxJQUFKLENBQVNDLElBQVQsQ0FBY0MsT0FBZCxDQUFzQmhCLEtBQXRCLENBQWQ7O0FBRUFhLE1BQUlDLElBQUosQ0FBU0csR0FBVCxDQUFhQyxJQUFiLENBQWtCLEVBQUNoQixLQUFLQSxHQUFOLEVBQVdILE1BQU1hLE9BQWpCLEVBQWxCLEVBQTZDLElBQTdDLEVBQW1ETyxJQUFuRCxDQUF3RCxVQUFTQyxNQUFULEVBQWlCO0FBQ3hFUCxPQUFJQyxJQUFKLENBQVNPLFFBQVQsQ0FBa0JDLE9BQWxCLENBQTBCQyxJQUExQixDQUErQkgsT0FBT0ksT0FBdEMsRUFBK0N4QixLQUEvQyxFQUFzREksZUFBdEQ7O0FBRUEsT0FBTXFCLGVBQWV6QixNQUFNMEIsSUFBTixDQUFXLHlCQUFYLENBQXJCO0FBQ0EsT0FBR0QsYUFBYUUsSUFBYixFQUFILEVBQ0E7QUFDQ0YsaUJBQWFHLEVBQWIsQ0FBZ0IsT0FBaEIsRUFBeUJDLFlBQXpCO0FBQ0E7QUFDRCxHQVJEO0FBVUEsRUFoQkQ7O0FBbUJBLEtBQU1BLGVBQWUsU0FBZkEsWUFBZSxDQUFTcEIsQ0FBVCxFQUFZO0FBQ2hDQSxJQUFFQyxjQUFGO0FBQ0FELElBQUVFLGVBQUY7O0FBRUEsTUFBTW1CLGFBQWE3QixFQUFFLElBQUYsRUFBUUYsSUFBUixDQUFhLEtBQWIsQ0FBbkI7O0FBRUFFLElBQUVpQixJQUFGLENBQU87QUFDTmhCLFFBQUs0QjtBQURDLEdBQVAsRUFFR0MsT0FGSCxDQUVXLFVBQVVYLE1BQVYsRUFBa0I7QUFDNUJuQixLQUFFLGlDQUFGLEVBQXFDK0IsSUFBckMsQ0FBMENaLE1BQTFDLEVBQWtEYSxJQUFsRDtBQUNBaEMsS0FBRSx5QkFBRixFQUE2QmlDLElBQTdCO0FBQ0EsR0FMRDtBQU1BLEVBWkQ7O0FBZUY7O0FBRUU7Ozs7QUFJQXBDLFFBQU9xQyxJQUFQLEdBQWMsVUFBU2hCLElBQVQsRUFBZTs7QUFFNUJqQixRQUFNRixNQUFNb0MsSUFBTixDQUFXLFFBQVgsQ0FBTjs7QUFFQXBDLFFBQU00QixFQUFOLENBQVMsUUFBVCxFQUFtQnBCLGNBQW5COztBQUVBVztBQUNBLEVBUEQ7O0FBU0E7QUFDQSxRQUFPckIsTUFBUDtBQUNBLENBeEVGIiwiZmlsZSI6IndpZGdldHMvZ2lmdC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gZ2lmdC5qcyAyMDE4LTA0LTI0XG4gR2FtYmlvIEdtYkhcbiBodHRwOi8vd3d3LmdhbWJpby5kZVxuIENvcHlyaWdodCAoYykgMjAxNiBHYW1iaW8gR21iSFxuIFJlbGVhc2VkIHVuZGVyIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSAoVmVyc2lvbiAyKVxuIFtodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvZ3BsLTIuMC5odG1sXVxuIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gKi9cblxuZ2FtYmlvLndpZGdldHMubW9kdWxlKFxuXHQnZ2lmdCcsXG5cblx0Wyd4aHInLCAnZm9ybSddLFxuXG5cdGZ1bmN0aW9uKGRhdGEpIHtcblxuXHRcdCd1c2Ugc3RyaWN0JztcblxuLy8gIyMjIyMjIyMjIyBWQVJJQUJMRSBJTklUSUFMSVpBVElPTiAjIyMjIyMjIyMjXG5cblx0XHR2YXIgJHRoaXMgPSAkKHRoaXMpLFxuXHRcdFx0dXJsID0gbnVsbCxcblx0XHRcdGRlZmF1bHRzID0ge30sXG5cdFx0XHRzZWxlY3Rvck1hcHBpbmcgPSB7XG5cdFx0XHRcdGdpZnRDb250ZW50OiAnLmdpZnQtY2FydC1jb250ZW50LXdyYXBwZXInXG5cdFx0XHR9LFxuXHRcdFx0b3B0aW9ucyA9ICQuZXh0ZW5kKHRydWUsIHt9LCBkZWZhdWx0cywgZGF0YSksXG5cdFx0XHRtb2R1bGUgPSB7fTtcblxuXG5cdFx0dmFyIF9zdWJtaXRIYW5kbGVyID0gZnVuY3Rpb24oZSkge1xuXHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0ZS5zdG9wUHJvcGFnYXRpb24oKTtcblxuXHRcdFx0dmFyIGRhdGFzZXQgPSBqc2UubGlicy5mb3JtLmdldERhdGEoJHRoaXMpO1xuXG5cdFx0XHRqc2UubGlicy54aHIuYWpheCh7dXJsOiB1cmwsIGRhdGE6IGRhdGFzZXR9LCB0cnVlKS5kb25lKGZ1bmN0aW9uKHJlc3VsdCkge1xuXHRcdFx0XHRqc2UubGlicy50ZW1wbGF0ZS5oZWxwZXJzLmZpbGwocmVzdWx0LmNvbnRlbnQsICR0aGlzLCBzZWxlY3Rvck1hcHBpbmcpO1xuXHRcdFx0XHRcblx0XHRcdFx0Y29uc3QgJGRldGFpbHNMaW5rID0gJHRoaXMuZmluZCgnLmdpZnQtY2FydC1zaG93LWRldGFpbHMnKTtcblx0XHRcdFx0aWYoJGRldGFpbHNMaW5rLnNpemUoKSlcblx0XHRcdFx0e1xuXHRcdFx0XHRcdCRkZXRhaWxzTGluay5vbignY2xpY2snLCBfc2hvd0RldGFpbHMpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdH07XG5cblxuXHRcdGNvbnN0IF9zaG93RGV0YWlscyA9IGZ1bmN0aW9uKGUpIHtcblx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cdFx0XHRcblx0XHRcdGNvbnN0IGRldGFpbHNVcmwgPSAkKHRoaXMpLmRhdGEoJ3VybCcpO1xuXHRcdFx0XG5cdFx0XHQkLmFqYXgoe1xuXHRcdFx0XHR1cmw6IGRldGFpbHNVcmxcblx0XHRcdH0pLnN1Y2Nlc3MoZnVuY3Rpb24gKHJlc3VsdCkge1xuXHRcdFx0XHQkKCdkaXYucmVkZWVtLWNvZGUtZGV0YWlscy13cmFwcGVyJykuaHRtbChyZXN1bHQpLnNob3coKTtcblx0XHRcdFx0JCgnZGl2LnJlZGVlbS1jb2RlLXdyYXBwZXInKS5oaWRlKCk7XG5cdFx0XHR9KVxuXHRcdH07XG5cblxuLy8gIyMjIyMjIyMjIyBJTklUSUFMSVpBVElPTiAjIyMjIyMjIyMjXG5cblx0XHQvKipcblx0XHQgKiBJbml0IGZ1bmN0aW9uIG9mIHRoZSB3aWRnZXRcblx0XHQgKiBAY29uc3RydWN0b3Jcblx0XHQgKi9cblx0XHRtb2R1bGUuaW5pdCA9IGZ1bmN0aW9uKGRvbmUpIHtcblxuXHRcdFx0dXJsID0gJHRoaXMuYXR0cignYWN0aW9uJyk7XG5cblx0XHRcdCR0aGlzLm9uKCdzdWJtaXQnLCBfc3VibWl0SGFuZGxlcik7XG5cblx0XHRcdGRvbmUoKTtcblx0XHR9O1xuXG5cdFx0Ly8gUmV0dXJuIGRhdGEgdG8gd2lkZ2V0IGVuZ2luZVxuXHRcdHJldHVybiBtb2R1bGU7XG5cdH0pOyJdfQ==
